clear all;
close all;

%% 1. Задание исходных данных
% Параметры распределения Эрланга
b = 1;  % параметр масштаба
c = 3;  % параметр формы (целое число)
% Параметры генерации
N = 1000;  % число реализаций

%% 2. Теоретические значения характеристик
m = b * c;  % теоретическое математическое ожидание
d = b^2 * c;  % теоретическая дисперсия
% Теоретическая плотность распределения Эрланга
p = @(x) (x.^(c-1) .* exp(-x / b)) / (b^c * factorial(c-1));

%% 3. Генерация реализаций случайной величины Эрланга
% Генерация c экспоненциально распределенных случайных величин и их суммирование
x = sum(exprnd(b, c, N));

%% 4. Вычисление выборочных характеристик
M = mean(x);  % выборочное среднее
D = var(x);   % выборочная дисперсия

% Вывод значений теоретических и выборочных характеристик
disp('Среднее значение (теоретическое):'); 
disp(m);
disp('Среднее значение (выборочное):');
disp(M);
disp('Дисперсия (теоретическая):');
disp(d);
disp('Дисперсия (выборочная):');
disp(D);

%% 5. Построение графика зависимости выборочной дисперсии от числа реализаций
num_realizations = 10:10:N;
sample_variance = zeros(1, length(num_realizations));
for i = 1:length(num_realizations)
    sample_variance(i) = var(x(1:num_realizations(i)));
end

figure;
plot(num_realizations, sample_variance, 'b', 'LineWidth', 2);
hold on;
yline(d, 'r--', 'LineWidth', 2);  % теоретическая дисперсия
xlabel('Число реализаций');
ylabel('Выборочная дисперсия');
legend('Выборочная дисперсия', 'Теоретическая дисперсия');
title('Зависимость выборочной дисперсии от числа реализаций');

%% 6. Построение гистограммы и эмпирической плотности распределения
% Визуализация нормированной гистограммы
figure;
histogram(x, 'Normalization', 'pdf');
hold on;

% Теоретическая плотность распределения
Xc = linspace(min(x), max(x), 100);
f_theoretical = p(Xc);
plot(Xc, f_theoretical, 'r', 'LineWidth', 2);
xlabel('Значение');
ylabel('Плотность вероятности');
legend('Эмпирическая плотность', 'Теоретическая плотность');
title('Сравнение эмпирической и теоретической плотностей');

%% 7. График средней абсолютной разности между эмпирической и теоретической плотностью
bin_counts = histcounts(x, 'Normalization', 'pdf');
bin_centers = linspace(min(x), max(x), length(bin_counts));
empirical_density = bin_counts;

% Вычисление средней абсолютной разности
abs_diff = abs(empirical_density - p(bin_centers));
mean_abs_diff = mean(abs_diff);

disp('Средняя абсолютная разность эмпирической и теоретической плотностей:');
disp(mean_abs_diff);

% Визуализация средней абсолютной разности
figure;
plot(bin_centers, abs_diff, 'b', 'LineWidth', 2);
xlabel('Значение');
ylabel('Средняя абсолютная разность');
title('Средняя абсолютная разность между эмпирической и теоретической плотностью');
