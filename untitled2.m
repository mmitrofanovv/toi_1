%%% Вычисление характеристик Эрланговской случайной величины
clear all
close all

%% 1. Задание исходных данных
% Параметры распределения Эрланга
b = 1;      % параметр масштаба
c = 3;      % параметр формы (целое число)

% Параметры генерации
n = 12;     % размерность равномерной случайной величины (РСВ)
N = 1000;   % начальное число реализаций

%% 2. Теоретические значения характеристик распределения
m = b * c;          % математическое ожидание
d = b^2 * c;        % дисперсия

% Функция плотности распределения Эрланга
p = @(x) (x.^(c-1)) .* exp(-x/b) / (b^c * factorial(c-1));

%% 3. Генерация реализаций Эрланговской случайной величины
% Генерация экспоненциальных случайных величин
lambda = 1 / b;     % параметр экспоненциального распределения
x_erlang = sum(-log(rand(c, N)) / lambda);  % генерация N реализаций Эрланга

%% 4. Построение зависимости выборочной дисперсии от числа реализаций
num_realizations = 100:100:N;  % массив для хранения количества реализаций
D_sample = zeros(size(num_realizations));  % выборочная дисперсия

for k = 1:length(num_realizations)
    x_subset = x_erlang(1:num_realizations(k));  % подмножество реализаций
    D_sample(k) = var(x_subset);  % выборочная дисперсия
end

figure;
plot(num_realizations, D_sample, 'b-', 'LineWidth', 2);
hold on;
yline(d, 'r--', 'LineWidth', 2);  % теоретическая дисперсия
xlabel('Число реализаций');
ylabel('Выборочная дисперсия');
legend('Выборочная дисперсия', 'Теоретическая дисперсия');
title('Зависимость выборочной дисперсии от числа реализаций');

%% 5. Построение гистограммы и графика плотности распределения
% Построение нормированной гистограммы
figure;
histogram(x_erlang, 'Normalization', 'pdf');
hold on;

% Отрисовка теоретической плотности распределения Эрланга
x_vals = linspace(min(x_erlang), max(x_erlang), 100);
plot(x_vals, p(x_vals), 'r-', 'LineWidth', 2);
xlabel('x');
ylabel('Плотность распределения');
legend('Гистограмма', 'Теоретическая плотность');
title('Эмпирическая и теоретическая плотности распределения Эрланга');

%% 6. Зависимость средней абсолютной разности плотностей
abs_diff = zeros(size(num_realizations));

for k = 1:length(num_realizations)
    x_subset = x_erlang(1:num_realizations(k));
    
    % Вычисление эмпирической плотности
    [f_emp, edges] = histcounts(x_subset, 'Normalization', 'pdf');
    centers = (edges(1:end-1) + edges(2:end)) / 2;  % центры интервалов
    
    % Теоретические значения плотности в этих точках
    f_theoretical = p(centers);
    
    % Средняя абсолютная разность
    abs_diff(k) = mean(abs(f_emp - f_theoretical));
end

figure;
plot(num_realizations, abs_diff, 'b-', 'LineWidth', 2);
xlabel('Число реализаций');
ylabel('Средняя абсолютная разность');
title('Средняя абсолютная разность плотностей от числа реализаций');
